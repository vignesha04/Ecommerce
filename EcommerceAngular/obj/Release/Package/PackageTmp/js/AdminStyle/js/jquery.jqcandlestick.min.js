!function(t){var e=t(window);t.fn.jqCandlestick=function(i){if(i.theme){if(!t.fn.jqCandlestick.themes[i.theme])throw"Undefined theme: "+i.theme;i=t.extend(!0,{},t.fn.jqCandlestick.themes[i.theme],i)}var s=t.extend(!0,{},t.fn.jqCandlestick.defaults,i),n=this;n.addClass(s.containerClass);var a=t("<canvas/>").attr(s.chartCanvasAttrs).appendTo(n),o=t("<canvas/>").attr(s.crossCanvasAttrs).appendTo(n),l=a.get(0),r=o.get(0);if(!l.getContext||!r.getContext)throw"canvas unsupported";var h=s.data,c=s.xAxis.dataOffset;if(h.sort(function(t,e){return t[c]-e[c]}),null==s.xAxis.min||null==s.xAxis.max){var u=null,d=null;h.forEach(function(t){u=u?Math.min(u,t[c]):t[c],d=d?Math.max(d,t[c]):t[c]}),null==s.xAxis.min&&(s.xAxis.min=u),null==s.xAxis.max&&(s.xAxis.max=d)}var p=[];s.yAxis=[].concat(s.yAxis);var f=0;s.yAxis.forEach(function(e){e=t.extend(!0,{},s.yAxisDefaults,e),f+=e.height;var i={yAxis:e,height:e.height,min:null,max:null,minY:null,maxY:null,series:[]};if(null!==e.labels.format.fixed){var n=e.labels.format.fixed;i.formatLabel=function(t){return null!=t?t.toFixed(n):"n/a"}}else"function"==typeof e.labels.format?i.formatLabel=e.labels.format:i.formatLabel=function(t){return t};p.push(i)}),p.forEach(function(t){t.height=t.height/f}),s.series.forEach(function(e){e=t.extend(!0,{},s.seriesDefaults,e);var i=p[e.yAxis];if(!i)throw"Undefined y-axis: "+e.yAxis;var n=t.fn.jqCandlestick.types[e.type];if(!n)throw"Unknown plot type: "+e.type;e=t.extend(!0,{},n,e);var a=e.dataOffset+n.dataSize;h.forEach(function(t){for(var s=e.dataOffset;a>s;s++){if(null==t[s])throw"Missing data column: "+s;i.min?i.min=Math.min(i.min,t[s]):i.min=t[s],i.max?i.max=Math.max(i.max,t[s]):i.max=t[s]}}),i.series.push(e)}),p.forEach(function(t){var e=Math.pow(10,Math.floor(Math.log(t.max)/Math.log(10)));t.max=Math.ceil(t.max/e)*e,t.min=Math.floor(t.min/e)*e});var g=0,m=0,v=function(t){var e=null;return p.some(function(i){return t>=i.minY&&t<=i.maxY?(e=null!=i.min&&null!=i.max?i.formatLabel(i.max-(t-i.minY)/(i.maxY-i.minY)*(i.max-i.min)):"n/a",!0):!1}),e},x=function(t){return s.xAxis.min+(t-s.xAxis.minX)/(s.xAxis.maxX-s.xAxis.minX)*(s.xAxis.max-s.xAxis.min)},b=function(t){if(t>=g&&m>=t){for(var e=x(t),i=null,n=null,a=0;a<h.length;a++){var o=Math.abs(h[a][s.xAxis.dataOffset]-e);if(!(null==n||n>o))break;n=o,i=a}if(null!=i)return h[i]}return null},y=function(t){return Math.floor(s.xAxis.minX+(t-s.xAxis.min)/(s.xAxis.max-s.xAxis.min)*(s.xAxis.maxX-s.xAxis.minX))+.5},w=function(t,e){return Math.floor(t.maxY-(e-t.min)/(t.max-t.min)*(t.maxY-t.minY))+.5},S=function(){var t=l.getContext("2d"),e=l.height,i=e-(p.length+1)*s.plot.spacing-s.padding.top-s.info.height-s.padding.bottom-s.xAxis.height,n=s.padding.top+s.info.height+s.plot.spacing+.5;if(g=0,m=l.width-s.padding.right,p.forEach(function(e){e.minY=n,n+=i*e.height,e.maxY=n,n+=s.plot.spacing,t.font=e.yAxis.labels.font?e.yAxis.labels.font:s.font,g=Math.max(g,t.measureText(e.formatLabel(e.min)).width,t.measureText(e.formatLabel(e.max)).width)}),g+=s.padding.left+10+.5,s.xAxis.minX=g+s.plot.padding.left,s.xAxis.maxX=m-s.plot.padding.right,t.textAlign="right",t.textBaseline="middle",p.forEach(function(e){t.font=e.yAxis.labels.font?e.yAxis.labels.font:s.font,t.fillStyle=e.yAxis.labels.color,t.strokeStyle=e.yAxis.color,t.lineWidth=e.yAxis.strokeWidth;var i;e.max-e.min;i=null!=e.yAxis.numTicks?e.yAxis.numTicks:Math.ceil((e.maxY-e.minY)/e.yAxis.tickDistance);for(var n=(e.maxY-e.minY)/i,a=(e.max-e.min)/i,o=e.minY+n/2,l=e.max-a/2,r=0;i>r;r++)t.fillText(e.formatLabel(l),g-10,o),t.beginPath(),t.moveTo(g,Math.floor(o)+.5),t.lineTo(m,Math.floor(o)+.5),t.stroke(),o+=n,l-=a}),s.xAxis.height>0){t.strokeStyle=s.xAxis.color,t.lineWidth=s.xAxis.strokeWidth,t.beginPath();var a=e-s.xAxis.height-s.padding.bottom-.5;t.moveTo(0,a),t.lineTo(l.width,a),t.stroke(),t.font=s.xAxis.labels.font?s.xAxis.labels.font:s.font,t.fillStyle=s.xAxis.labels.color,t.textAlign="center";for(var o=a+s.xAxis.height/2,r=s.xAxis.max-s.xAxis.min,c=Math.ceil((s.xAxis.maxX-s.xAxis.minX)/80),u=r/c,d=u/6e4,f=d/60,v=[6e4,12e4,3e5,6e5,9e5,18e5,36e5,72e5,108e5,216e5,432e5,864e5],x=6e4,b=0;b<v.length&&(x=v[b],!(x>=u));b++);for(var S=Math.ceil(s.xAxis.min/x)*x,C=s.xAxis.tickSize,k=y(S);m>k;S+=x,k=y(S)){var P,L=new Date(S);if(0==L.getHours()&&0==L.getMinutes())P=s.xAxis.months[L.getMonth()]+" "+L.getDate();else{var f=L.getHours();10>f&&(f="0"+f);var d=L.getMinutes();10>d&&(d="0"+d),P=f+":"+d}var A=t.measureText(P).width;k+A/2>m||(t.fillText(P,k,o),t.beginPath(),0!=C&&(t.moveTo(k,a),t.lineTo(k,a-C),t.stroke()))}}t.fillStyle="#900",p.forEach(function(e){e.series.forEach(function(i){i.draw(t,s,e,i,h,y,w)})})},C=0,k=0,P=!1;e.mousemove(function(t){P=!0,C=t.pageX-n.offset().left+.5,k=t.pageY-n.offset().top+.5});var L=0,A=0,T=function(){(n.width()!=L||n.height()!=A)&&(l.width=n.width(),l.height=n.height(),r.width=n.width(),r.height=n.height(),L=n.width(),A=n.height(),S())},F=function(){if(T(),P){P=!1;var t=r.getContext("2d");if(t.strokeStyle=s.cross.color,t.lineWidth=s.cross.strokeWidth,t.clearRect(0,0,r.width,r.height),!(0>C||C>=r.width||0>k||k>=r.height)){var e=b(C);if(e&&(C=y(e[s.xAxis.dataOffset])),t.beginPath(),t.moveTo(C,0),t.lineTo(C,r.height),t.stroke(),t.beginPath(),t.moveTo(0,k),t.lineTo(r.width,k),t.stroke(),e){t.fillStyle=s.info.color,t.font=s.info.font?s.info.font:s.font,"right"==s.info.position?t.textAlign="right":t.textAlign="left","auto"==s.info.position?t.textBaseline="top":t.textBaseline="middle";var i=s.padding.top+Math.floor(s.info.height/2)+.5,n=[],a=new Date(e[s.xAxis.dataOffset]);n.push(s.xAxis.name+": "+s.info.formatDate(a)),p.forEach(function(t){t.series.forEach(function(i){if(1==i.dataSize)n.push(i.name+": "+t.formatLabel(e[i.dataOffset]));else for(var s=0;s<i.dataSize;s++)n.push(i.names[s]+": "+t.formatLabel(e[i.dataOffset+s]))})});var o=i;if("right"==s.info.position){var l=m;n.forEach(function(e){var i=t.measureText(e).width+s.info.spacing;"auto"==s.info.wrap&&g>l-i&&(l=m,o+=s.info.height),t.fillText(e,l,o),"yes"==s.info.wrap?o+=s.info.height:l-=i})}else{var l=g;"auto"==s.info.position&&(l=C+5,o=k+5),n.forEach(function(e){var i=t.measureText(e).width+s.info.spacing;"auto"==s.info.wrap&&l+i>m&&(l="auto"==s.info.position?C+5:g,o+=s.info.height),t.fillText(e,l,o),"yes"==s.info.wrap?o+=s.info.height:l+=i})}}var h=v(k);if(null!=h){var c=t.measureText(h).width,u=Math.floor(s.cross.text.height/2),d=g,f=d-5,x=d-10,w=d-(c+15);d>C&&(w=d+(c+15),f=d+5,x=w-5),t.beginPath(),t.moveTo(w,k-u),t.lineTo(f,k-u),t.lineTo(d,k),t.lineTo(f,k+u+1),t.lineTo(w,k+u+1),t.lineTo(w,k-u),t.fillStyle=s.cross.text.background,t.fill(),t.stroke(),t.fillStyle=s.cross.text.color,t.font=s.cross.text.font?s.cross.text.font:s.font,t.textAlign="right",t.textBaseline="middle",t.fillText(h,x,k)}}}};return setInterval(F,1e3/60),this},t.fn.jqCandlestick.defaults={series:[],data:[],theme:"light",font:"8pt sans-serif",padding:{top:0,left:10,bottom:0,right:0},plot:{spacing:5,padding:{top:0,left:15,bottom:0,right:15}},xAxis:{name:"DATE",months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dataOffset:0,min:null,max:null,minX:0,maxX:0,height:20,color:"#333",strokeWidth:1,tickSize:5,labels:{font:null,color:"#999",format:"date"}},yAxis:[{height:1}],yAxisDefaults:{height:1,color:"#222",strokeWidth:1,numTicks:null,tickDistance:40,labels:{font:null,color:"#999",format:{fixed:2}}},seriesDefaults:{type:"point",name:null,names:[],dataOffset:1,yAxis:0,color:"#fff"},info:{color:"#999",height:20,font:null,spacing:20,position:"left",wrap:"auto",formatDate:function(t){var e=t.getFullYear(),i=t.getMonth()+1;10>i&&(i="0"+i);var s=t.getDate();10>s&&(s="0"+s);var n=t.getHours();10>n&&(n="0"+n);var a=t.getMinutes();return 10>a&&(a="0"+a),e+"-"+i+"-"+s+" "+n+":"+a}},cross:{color:"rgba(255, 255, 255, 0.5)",strokeWidth:1,text:{height:20,background:"#000",font:null,color:"#999"}},containerClass:"jqcandlestick-container",chartCanvasAttrs:{"class":"jqcandlestick-canvas"},crossCanvasAttrs:{"class":"jqcandlestick-canvas"}},t.fn.jqCandlestick.themes={light:{xAxis:{color:"#333",labels:{color:"#222"}},yAxisDefaults:{color:"#eee",labels:{color:"#222"}},seriesDefaults:{color:"#000"},cross:{color:"rgba(0, 0, 0, 0.5)",text:{background:"#fff",color:"#222"}},info:{color:"#222"}},dark:{xAxis:{color:"#333",labels:{color:"#999"}},yAxisDefaults:{color:"#222",labels:{color:"#999"}},seriesDefaults:{color:"#fff"},cross:{color:"rgba(255, 255, 255, 0.5)",text:{background:"#000",color:"#999"}},info:{color:"#999"}}},t.fn.jqCandlestick.types={point:{dataSize:1,radius:3,stroke:null,strokeWidth:2,draw:function(t,e,i,s,n,a,o){t.fillStyle=s.color,t.lineWidth=s.strokeWidth,n.forEach(function(n){var l=a(n[e.xAxis.dataOffset]),r=o(i,n[s.dataOffset]);t.beginPath(),t.arc(l,r,s.radius,0,2*Math.PI,!0),t.fill(),s.stroke&&(t.strokeStyle=s.stroke,t.lineWidth=s.strokeWidth,t.stroke())})}},line:{dataSize:1,strokeWidth:2,draw:function(t,e,i,s,n,a,o){t.strokeStyle=s.color,t.lineWidth=s.strokeWidth,t.beginPath();var l=null,r=null;n.forEach(function(n){var h=a(n[e.xAxis.dataOffset]),c=o(i,n[s.dataOffset]);l&&r?t.lineTo(h,c):t.moveTo(h,c),l=h,r=c}),t.stroke()}},column:{dataSize:1,width:5,stroke:null,strokeWidth:1,draw:function(t,e,i,s,n,a,o){t.fillStyle=s.color,s.stroke&&(t.strokeStyle=s.stroke,t.lineWidth=s.strokeWidth),n.forEach(function(n){var l=a(n[e.xAxis.dataOffset]),r=o(i,n[s.dataOffset]);t.fillRect(Math.floor(l-s.width/2)+.5,r,s.width,i.maxY-r),s.stroke&&t.strokeRect(Math.floor(l-s.width/2)+.5,r,s.width,i.maxY-r)})}},candlestick:{dataSize:4,names:["OPEN","HIGH","LOW","CLOSE"],width:5,downColor:null,downStroke:null,downStrokeWidth:1,upColor:null,upStroke:null,upStrokeWidth:1,draw:function(t,e,i,s,n,a,o){n.forEach(function(n){var l=n[s.dataOffset],r=n[s.dataOffset+1],h=n[s.dataOffset+2],c=n[s.dataOffset+3],u=a(n[e.xAxis.dataOffset]),d=o(i,l),p=o(i,r),f=o(i,h),g=o(i,c),m=Math.floor(s.width/2);t.beginPath(),t.moveTo(u,p),t.strokeStyle=s.color,g>d?(s.downColor?t.fillStyle=s.downColor:t.fillStyle=s.color,t.fillRect(u-m,d,s.width,g-d),s.downStroke&&(t.strokeStyle=s.downStroke,t.lineWidth=s.downStrokeWidth,t.strokeRect(u-m,d,s.width,g-d)),t.lineTo(u,d),t.moveTo(u,g)):(s.upColor&&(t.fillStyle=s.upColor,t.fillRect(u-m,g,s.width,d-g)),s.upStroke?t.strokeStyle=s.upStroke:t.strokeStyle=s.color,t.lineWidth=s.upStrokeWidth,t.strokeRect(u-m,g,s.width,d-g),t.lineTo(u,g),t.moveTo(u,d)),t.lineTo(u,f),t.stroke()})}}}}(jQuery);